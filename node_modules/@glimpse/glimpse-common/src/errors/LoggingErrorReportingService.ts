import * as chalk from 'chalk';
import * as util from 'util';

import { IErrorReportingService } from './IErrorReportingService';
import { IGlimpseError, GlimpseErrorSeverity } from './IGlimpseError';
import { getSlugForErrorCode } from './ErrorCodes';

function chalkBySeverity(severity: GlimpseErrorSeverity, message: string): string {
    switch (severity) {
        case GlimpseErrorSeverity.Error:
            return chalk.red(message);
        case GlimpseErrorSeverity.Warning:
            return chalk.yellow(message);
        default:
            return message;
    }
}

export class LoggingErrorReportingService implements IErrorReportingService {
    public reportError(error: IGlimpseError, ...params): void {
        const header = chalkBySeverity(error.severity, `Glimpse: ${GlimpseErrorSeverity[error.severity].toLocaleUpperCase()} (${getSlugForErrorCode(error.errorCode)}):`);
        const message = util.format(error.message, ...params);

        // NOTE: VS Code will not recognize chalk-ed URLs, so we don't use it for our error links.
        const url = error.url ? ` (See ${error.url})` : '';

        console.error(`${header} ${message}${url}`);
    }
}
