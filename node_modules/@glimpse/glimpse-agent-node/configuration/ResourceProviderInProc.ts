'use strict';

import { IContextManager, IContext } from '../messaging/IContextManager';
import { IResourceProvider } from './IResourceProvider';
import { RequestHelper } from '../util/HttpHelper';

export class ResourceProviderInProc implements IResourceProvider {
    public constructor(private contextManager: IContextManager, private server) {
    }

    public getResourceDefinitions(context: IContext): { [key: string]: string } {
        this.contextManager.checkContextID('ResourceProviderInProc::getResourceDefinitions', context ? context.id : undefined);

        if (context) {
            const protocol = RequestHelper.protocol(context.req);
            const host = RequestHelper.host(context.req);
            const baseUri = protocol + '://' + host + '/glimpse';

            return this.server.providers.resourceManager.getUriTemplates(baseUri);
        }

        return undefined;
    }
}
